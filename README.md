# ControlRec: Bridging the Semantic Gap between Language Model and Personalized Recommendation

This repository contains the code and resources for the paper "ControlRec: Bridging the Semantic Gap between Language Model and Personalized Recommendation".

### Abstract
The successful integration of large language models (LLMs) into recommendation systems has proven to be a major breakthrough in recent studies, paving the way for more generic and transferable recommendations. However, LLMs struggle to effectively utilize user and item IDs, which are crucial identifiers for successful recommendations. This is mainly due to their distinct representation in a semantic space that is different from the natural language (NL) typically used to train LLMs. To tackle such issue, we introduce ControlRec, an innovative Contrastive prompt learning framework for Recommendation systems. ControlRec treats user IDs and NL as heterogeneous features and encodes them individually. To promote greater alignment and integration between them in the semantic space, we have devised two auxiliary contrastive objectives: (1) Heterogeneous Feature Matching (HFM) aligning item description with the corresponding ID or user's next preferred ID based on their interaction sequence, and (2) Instruction Contrastive Learning (ICL) effectively merging these two crucial data sources by contrasting probability distributions of output sequences generated by diverse tasks. Experimental results on four public real-world datasets demonstrate the effectiveness of the proposed method on improving model performance, and the robustness against the choice of prompts. 

### Code Structure
The repository is organized as follows:
* `data` This directory contains the necessary datasets. You can download preprocessed data from [P5 Google Drive Link](https://drive.google.com/file/d/1qGxgmx7G_WB7JE4Cn_bEcZ_o_NAJLE3G/view?usp=sharing), then put them into the data folder.
* `models` This directory contains the implementation of the ControlRec model and related modules.
* `src` This directory contains all source code.
* `cached` All checkpoints will be dumped in this directory.
* `prompt` This directory keeps triggers, prompts and the prompt generation scripts.
* `notebooks` This directory contains implementation of evaluation metrics.


### Usage
To train and evaluate the ControlRec model, follow the steps below:

1. Down load the processed data in the `data/` directory.
2. Run the training script `pretrain_anony.py` in the src/ directory to pretrain the ControlRec model.
3. Run the evaluation script `evaluate_anony.py` in the experiments/ directory to evaluate the model's performance on the test set.